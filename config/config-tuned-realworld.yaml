# Typosentinel Configuration - Real-World Tuned
# Optimized based on real-world test results to improve detection rates

verbose: true
debug: false

api:
  host: "localhost"
  port: 8080
  cors_enabled: true
  rate_limiting:
    enabled: true
    requests_per_minute: 100

database:
  host: "localhost"
  port: 5432
  name: "typosentinel"
  user: "postgres"
  ssl_mode: "disable"

core:
  version: "1.0.0"
  environment: "production"
  debug: false
  verbose: true
  max_concurrency: 8
  timeout: "45s"
  retry_attempts: 3
  retry_delay: "2s"

logging:
  level: "info"
  format: "json"
  output: "stdout"
  structured: true
  file_output: "./logs/typosentinel.log"
  max_file_size: "100MB"
  max_backups: 5
  max_age: 30
  compress: true

performance:
  max_concurrency: 8
  worker_pool_size: 6
  queue_size: 200
  batch_size: 15
  memory_limit: "512MB"
  cpu_limit: "2"

# Enhanced Detection Configuration - Tuned for Real-World Performance
detection:
  enabled: true
  min_package_name_length: 2  # Reduced from 3 to catch more threats
  enhanced_typosquatting: true
  homoglyph_detection: true
  dependency_confusion: true
  reputation_scoring: true
  
  # Adjusted thresholds based on test results
  thresholds:
    similarity: 0.65      # Reduced from 0.8 to catch more typosquatting
    confidence: 0.55      # Reduced from 0.7 to be less conservative
    reputation: 0.45      # Reduced from 0.6 to flag more suspicious packages
  
  algorithms:
    lexical: true
    homoglyph: true
    ml: true

# ML Analysis Configuration - Optimized Thresholds
ml_analysis:
  enabled: true
  model_path: "./models"
  embedding_model: "sentence-transformers/all-MiniLM-L6-v2"
  embedding_dimensions: 384
  
  # Tuned thresholds based on real-world test results
  similarity_threshold: 0.65    # Reduced from 0.8 - more sensitive to similarities
  malicious_threshold: 0.55     # Reduced from 0.7 - catch more threats
  reputation_threshold: 0.45    # Reduced from 0.6 - flag low-reputation packages
  
  # Performance optimizations
  batch_size: 15
  max_features: 1500
  cache_embeddings: true
  parallel_processing: true
  gpu_acceleration: false
  
  # Feature store configuration
  feature_store:
    enabled: true
    backend: "memory"
    ttl: "24h"
    max_size: 10000
    compression_enabled: true
    cleanup_interval: "6h"
  
  # Model updates
  model_updates:
    enabled: true
    update_interval: "24h"
    auto_update: false
    verify_signatures: true
    backup_old_models: true
    max_model_versions: 3

# Scanner Configuration
scanner:
  enabled: true
  concurrency: 6              # Increased from 4 for better performance
  include_dev_deps: true       # Include dev dependencies for comprehensive scanning
  enrich_metadata: true
  timeout: "60s"
  max_file_size: "50MB"
  
  # Enhanced scanning options
  deep_analysis: true
  behavioral_analysis: true
  static_analysis: true
  dynamic_analysis: false      # Disabled for performance

# Typosquatting Detection - Enhanced Configuration
typo_detection:
  enabled: true
  algorithms: ["levenshtein", "jaro_winkler", "soundex", "metaphone"]
  threshold: 0.65              # Reduced from default to catch more variants
  max_distance: 3              # Increased to catch more distant typos
  check_similar_names: true
  check_homoglyphs: true
  check_keyboard_layout: true
  check_common_typos: true
  language_specific: true
  case_sensitive: false

# Malware Detection Configuration
malware_detection:
  enabled: true
  signature_database: "./data/signatures.db"
  heuristic_analysis: true
  behavioral_analysis: true
  sandbox_analysis: false      # Disabled for performance
  cloud_scanning: false
  real_time_protection: true
  update_interval: "12h"
  scan_timeout: "30s"
  max_scan_size: "100MB"

# Vulnerability Scanning
vulnerability_scanning:
  enabled: true
  databases: ["nvd", "osv", "github"]
  severity_threshold: "medium"
  include_dev_dependencies: true
  update_interval: "6h"
  cache_results: true
  cache_ttl: "24h"

# Provenance Analysis
provenance_analysis:
  enabled: true
  sigstore_enabled: true
  slsa_enabled: true
  slsa_min_level: 2
  verify_signatures: true
  verify_provenance: true
  verify_integrity: true
  require_transparency_log: false
  timeout: "30s"
  retry_attempts: 2

# Policy Configuration
policies:
  enabled: true
  fail_on_threats: false       # Don't fail immediately, allow review
  min_threat_level: "medium"   # Lowered from high to catch more issues
  rules:
    - name: "block_critical_threats"
      description: "Block packages with critical threat level"
      enabled: true
      conditions: ["threat_level >= critical"]
      actions: ["block", "alert"]
    
    - name: "warn_high_threats"
      description: "Warn on high threat level packages"
      enabled: true
      conditions: ["threat_level >= high"]
      actions: ["warn", "log"]
    
    - name: "monitor_medium_threats"
      description: "Monitor medium threat level packages"
      enabled: true
      conditions: ["threat_level >= medium"]
      actions: ["log", "monitor"]
    
    - name: "typosquatting_protection"
      description: "Enhanced typosquatting protection"
      enabled: true
      conditions: ["similarity_score >= 0.65", "is_typosquatting == true"]
      actions: ["warn", "suggest_alternative"]

# Plugin Configuration
plugins:
  enabled: true
  path: "./plugins"
  plugin_directory: "./plugins"
  auto_load: true
  plugins:
    - name: "enhanced_scanner"
      path: "./plugins/enhanced_scanner.so"
      enabled: true
      config:
        deep_scan: true
        timeout: "30s"

# Cache Configuration
cache:
  enabled: true
  ttl: "2h"                   # Reduced TTL for more frequent updates
  cache_dir: "./cache"
  max_size: "1GB"
  cleanup_interval: "1h"
  compression: true

# ML Service Configuration
ml_service:
  enabled: false
  endpoint: "http://localhost:8001"
  timeout: "45s"
  max_retries: 3
  batch_size: 15
  connection_pool_size: 10

# Registry Configuration
registries:
  - name: "npm"
    enabled: true
    base_url: "https://registry.npmjs.org"
    timeout: "30s"
    rate_limit:
      enabled: true
      rps: 10
      burst: 20
  
  - name: "pypi"
    enabled: true
    base_url: "https://pypi.org"
    timeout: "30s"
    rate_limit:
      enabled: true
      rps: 8
      burst: 15

# Monitoring and Alerting
monitoring:
  enabled: true
  metrics_endpoint: "/metrics"
  health_endpoint: "/health"
  profiling_enabled: false
  
  alerts:
    enabled: true
    webhook_url: ""
    email_notifications: false
    slack_notifications: false

# Security Configuration
security:
  api_key_required: false
  rate_limiting: true
  cors_enabled: true
  tls_enabled: false
  certificate_path: ""
  private_key_path: ""

# Experimental Features
experimental:
  enabled: true
  features:
    - "advanced_ml_scoring"
    - "behavioral_analysis"
    - "reputation_learning"
    - "adaptive_thresholds"

# Output Configuration
output:
  format: "json"
  include_metadata: true
  include_recommendations: true
  include_confidence_scores: true
  verbose_errors: true
  color_output: true