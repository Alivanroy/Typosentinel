# TypoSentinel Integrations Configuration Example
# This file demonstrates how to configure various security tool integrations

integrations:
  enabled: true
  
  # Global filters that apply to all connectors
  filters:
    - name: "high_severity_only"
      type: "severity"
      condition: "equals"
      value: "high"
      metadata:
        description: "Only forward high severity threats"
    
    - name: "exclude_test_packages"
      type: "package_name"
      condition: "contains"
      value: "test"
      metadata:
        description: "Exclude packages with 'test' in the name"
        exclude: true

  # Connector configurations
  connectors:
    # Splunk SIEM Integration
    splunk_siem:
      type: "splunk"
      enabled: true
      settings:
        hec_url: "https://splunk.company.com:8088/services/collector/event"
        hec_token: "your-hec-token-here"
        index: "typosentinel"
        source: "typosentinel_scanner"
        sourcetype: "security_event"
        verify_ssl: true
        timeout: 30
      retry:
        enabled: true
        max_attempts: 3
        initial_delay: "1s"
        max_delay: "30s"
        backoff_factor: 2.0
      filters:
        - "high_severity_only"
    
    # Slack Notifications
    security_alerts:
      type: "slack"
      enabled: true
      settings:
        webhook_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
        channel: "#security-alerts"
        username: "TypoSentinel"
        icon_emoji: ":shield:"
        mention_users: ["@security-team"]
        mention_channels: ["@here"]
        color_mapping:
          critical: "danger"
          high: "warning"
          medium: "good"
          low: "#439FE0"
      retry:
        enabled: true
        max_attempts: 2
        initial_delay: "2s"
        max_delay: "10s"
        backoff_factor: 2.0
      filters: []
    
    # Generic Webhook Integration
    custom_webhook:
      type: "webhook"
      enabled: false
      settings:
        url: "https://api.company.com/security/webhooks/typosentinel"
        method: "POST"
        headers:
          Authorization: "Bearer your-api-token"
          Content-Type: "application/json"
          X-Source: "TypoSentinel"
        timeout: 15
        verify_ssl: true
        custom_payload:
          enabled: true
          template: |
            {
              "event_type": "{{.Type}}",
              "severity": "{{.Severity}}",
              "package": {
                "name": "{{.Package.Name}}",
                "version": "{{.Package.Version}}",
                "registry": "{{.Package.Registry}}"
              },
              "threat": {
                "type": "{{.Threat.Type}}",
                "description": "{{.Threat.Description}}",
                "risk_score": {{.Threat.RiskScore}},
                "confidence": {{.Threat.Confidence}}
              },
              "metadata": {
                "detection_method": "{{.Metadata.DetectionMethod}}",
                "project_path": "{{.Metadata.ProjectPath}}",
                "timestamp": "{{.Timestamp}}"
              }
            }
      retry:
        enabled: true
        max_attempts: 3
        initial_delay: "1s"
        max_delay: "60s"
        backoff_factor: 2.0
    
    # Email Notifications
    email_alerts:
      type: "email"
      enabled: false
      settings:
        smtp_host: "smtp.company.com"
        smtp_port: 587
        username: "typosentinel@company.com"
        password: "your-email-password"
        from_email: "typosentinel@company.com"
        from_name: "TypoSentinel Security Scanner"
        to_emails:
          - "security-team@company.com"
          - "devops@company.com"
        cc_emails:
          - "ciso@company.com"
        subject_prefix: "[SECURITY ALERT]"
        use_tls: true
        timeout: 30
      retry:
        enabled: true
        max_attempts: 2
        initial_delay: "5s"
        max_delay: "30s"
        backoff_factor: 2.0
      filters:
        - "high_severity_only"

# Advanced filter examples
# filters:
#   - name: "critical_malware_only"
#     type: "threat_type"
#     condition: "equals"
#     value: "malicious"
#     metadata:
#       min_severity: "critical"
#   
#   - name: "npm_packages_only"
#     type: "package_name"
#     condition: "regex"
#     value: "^@?[a-z0-9-]+$"
#     metadata:
#       registry: "npm"
#   
#   - name: "exclude_internal_packages"
#     type: "package_name"
#     condition: "contains"
#     value: "@company/"
#     metadata:
#       exclude: true