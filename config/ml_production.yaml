# Enhanced ML Model Production Configuration
# TypoSentinel Enhanced Threat Detection Model

ml:
  # Model Configuration
  model:
    name: "enhanced_threat_detection_model"
    version: "1.0"
    path: "./enhanced_threat_detection_model.json"
    backup_path: "./models/enhanced_threat_detection_model_backup.json"
    
  # Feature Engineering
  features:
    enabled: true
    feature_count: 25
    normalization: true
    scaling: "standard"
    
  # Prediction Settings
  prediction:
    confidence_threshold: 0.7
    edge_case_threshold: 0.8
    batch_size: 100
    timeout_ms: 1000
    
  # Registry Support
  registries:
    - name: "npm"
      enabled: true
      weight: 1.0
    - name: "pypi"
      enabled: true
      weight: 1.0
    - name: "maven"
      enabled: true
      weight: 1.0
    - name: "rubygems"
      enabled: true
      weight: 1.0
    - name: "crates"
      enabled: true
      weight: 1.0
    - name: "go"
      enabled: true
      weight: 1.0
      
  # Threat Detection
  threats:
    types:
      - "typosquatting"
      - "malware"
      - "cryptomining"
      - "backdoor"
      - "exploit"
      - "trojan"
      - "suspicious"
      - "supply_chain"
    
    # Enhanced Detection Rules
    rules:
      edge_cases:
        empty_name: true
        single_char_name: true
        numeric_name: true
        long_name_threshold: 50
        empty_author: true
        
      supply_chain:
        enabled: true
        age_popularity_ratio: true
        maintainer_history: true
        dependency_analysis: true
        
  # Performance Settings
  performance:
    max_processing_time_ms: 5
    target_throughput: 50000  # packages per second
    memory_limit_mb: 512
    cpu_cores: 4
    
  # Monitoring
  monitoring:
    enabled: true
    metrics:
      - "detection_rate"
      - "false_positive_rate"
      - "processing_time"
      - "confidence_distribution"
      - "threat_type_distribution"
      
    alerts:
      detection_rate_threshold: 0.85
      processing_time_threshold_ms: 1
      confidence_anomaly_threshold: 0.3
      
  # Logging
  logging:
    level: "info"
    predictions: true
    performance_metrics: true
    edge_cases: true
    errors: true
    
  # Fallback Configuration
  fallback:
    enabled: true
    rule_based_detection: true
    manual_review_threshold: 0.5
    
# Production Environment Settings
production:
  environment: "production"
  debug: false
  
  # Load Balancing
  load_balancing:
    enabled: true
    strategy: "round_robin"
    health_check_interval: 30
    
  # Caching
  cache:
    enabled: true
    ttl_seconds: 3600
    max_entries: 100000
    
  # Rate Limiting
  rate_limiting:
    enabled: true
    requests_per_second: 1000
    burst_size: 2000
    
  # Security
  security:
    api_key_required: true
    rate_limiting: true
    input_validation: true
    output_sanitization: true
    
# Deployment Settings
deployment:
  strategy: "blue_green"
  rollback_enabled: true
  health_check_url: "/health/ml"
  readiness_probe:
    initial_delay_seconds: 30
    period_seconds: 10
    timeout_seconds: 5
    failure_threshold: 3
    
  # Gradual Rollout
  rollout:
    enabled: true
    phases:
      - percentage: 10
        duration_minutes: 30
      - percentage: 25
        duration_minutes: 60
      - percentage: 50
        duration_minutes: 120
      - percentage: 100
        duration_minutes: 0
        
# Database Configuration
database:
  ml_metrics:
    enabled: true
    retention_days: 90
    
  predictions:
    enabled: true
    retention_days: 30
    
  feedback:
    enabled: true
    retention_days: 365
    
# Integration Settings
integration:
  api:
    endpoint: "/api/v1/ml/predict"
    batch_endpoint: "/api/v1/ml/predict/batch"
    health_endpoint: "/api/v1/ml/health"
    
  webhook:
    enabled: true
    url: "${WEBHOOK_URL}"
    events:
      - "prediction_made"
      - "anomaly_detected"
      - "model_error"
      
# Backup and Recovery
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 30
  location: "./backups/ml/"
  
recovery:
  auto_recovery: true
  fallback_model_path: "./models/fallback_model.json"
  max_retry_attempts: 3
  retry_delay_seconds: 5