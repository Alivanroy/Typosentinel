# Vulnerability Database Configuration
# This file configures multiple open-source vulnerability databases for Typosentinel

vulnerability_manager:
  # Enable parallel queries to multiple databases for faster results
  parallel_queries: true
  
  # Timeout for vulnerability database queries
  timeout: 30s
  
  # Enable caching of vulnerability data
  cache_enabled: true
  cache_ttl: 1h
  
  # Merge and deduplicate results from multiple databases
  merge_results: true
  deduplicate_by_id: true
  
  # Priority order for vulnerability databases (first = highest priority)
  priority:
    - "osv"      # Google OSV Database (fastest, most comprehensive)
    - "github"   # GitHub Security Advisory Database
    - "nvd"      # NIST National Vulnerability Database

  # Database configurations
  databases:
    # Google OSV (Open Source Vulnerabilities) Database
    # Free, comprehensive, and fast API for open source vulnerabilities
    - type: "osv"
      enabled: true
      base_url: "https://api.osv.dev"
      timeout: 15s
      options:
        batch_size: 100
        include_withdrawn: false
        
    # GitHub Security Advisory Database
    # Comprehensive vulnerability database maintained by GitHub
    - type: "github"
      enabled: true
      base_url: "https://api.github.com/advisories"
      # Optional: GitHub token for higher rate limits (5000 requests/hour vs 60/hour)
      # api_key: "ghp_your_github_token_here"
      timeout: 20s
      options:
        include_malware: true
        include_withdrawn: false
        
    # NIST National Vulnerability Database (existing integration)
    # Official US government vulnerability database
    - type: "nvd"
      enabled: true
      base_url: "https://services.nvd.nist.gov/rest/json/cves/2.0"
      # Optional: NVD API key for higher rate limits
      # api_key: "your_nvd_api_key_here"
      timeout: 25s
      options:
        results_per_page: 100
        include_cpe_match: true

# Registry to ecosystem mapping for vulnerability databases
ecosystem_mapping:
  npm: "npm"
  pypi: "PyPI"
  go: "Go"
  maven: "Maven"
  nuget: "NuGet"
  packagist: "Packagist"
  rubygems: "RubyGems"
  "crates.io": "crates.io"
  
# Severity mapping configuration
severity_mapping:
  # OSV severity levels
  osv:
    LOW: "low"
    MEDIUM: "medium"
    HIGH: "high"
    CRITICAL: "critical"
    
  # GitHub Advisory severity levels
  github:
    low: "low"
    medium: "medium"
    moderate: "medium"
    high: "high"
    critical: "critical"
    
  # NVD CVSS score to severity mapping
  nvd:
    "0.0-3.9": "low"
    "4.0-6.9": "medium"
    "7.0-8.9": "high"
    "9.0-10.0": "critical"

# Rate limiting configuration
rate_limiting:
  # OSV API rate limits (generous, no authentication required)
  osv:
    requests_per_minute: 600
    burst_size: 100
    
  # GitHub API rate limits
  github:
    # Without authentication
    unauthenticated_requests_per_hour: 60
    # With authentication (recommended)
    authenticated_requests_per_hour: 5000
    
  # NVD API rate limits
  nvd:
    # Without API key
    unauthenticated_requests_per_30_seconds: 5
    # With API key (recommended for production)
    authenticated_requests_per_30_seconds: 50

# Caching configuration
caching:
  # Cache vulnerability data to reduce API calls
  enabled: true
  
  # Cache TTL for different types of data
  vulnerability_ttl: 24h
  package_scan_ttl: 1h
  search_results_ttl: 30m
  
  # Cache storage backend
  backend: "memory"  # Options: memory, redis, file
  
  # Redis configuration (if using redis backend)
  redis:
    host: "localhost"
    port: 6379
    password: ""
    db: 0
    
  # File cache configuration (if using file backend)
  file:
    directory: "/tmp/typosentinel_cache"
    max_size_mb: 100

# Monitoring and alerting
monitoring:
  # Enable metrics collection for vulnerability database performance
  metrics_enabled: true
  
  # Alert thresholds
  alerts:
    # Alert if database response time exceeds threshold
    response_time_threshold: 10s
    
    # Alert if database error rate exceeds threshold
    error_rate_threshold: 0.1  # 10%
    
    # Alert if database is unavailable
    availability_threshold: 0.95  # 95%

# Development and testing configuration
development:
  # Use mock databases for testing
  use_mock_databases: false
  
  # Enable debug logging
  debug_logging: false
  
  # Test database endpoints
  test_endpoints:
    osv: "https://api.osv.dev/v1/query"
    github: "https://api.github.com/advisories"
    nvd: "https://services.nvd.nist.gov/rest/json/cves/2.0"