# GitHub Platform Configuration Example
# This file demonstrates comprehensive GitHub integration for TypoSentinel

# GitHub Platform Configuration
github:
  # GitHub API Configuration
  api:
    # Base URL for GitHub API (use https://api.github.com for GitHub.com)
    base_url: "https://api.github.com"
    
    # API version (optional, defaults to latest)
    version: "2022-11-28"
    
    # Request timeout
    timeout: "30s"
    
    # User agent for API requests
    user_agent: "TypoSentinel/1.0"

  # Authentication Configuration
  authentication:
    # Method 1: Personal Access Token (Recommended for individual use)
    personal_token:
      token: "${GITHUB_TOKEN}"
      scopes:
        - "repo"
        - "read:org"
        - "read:user"
        - "read:packages"
    
    # Method 2: GitHub App (Recommended for organizations)
    github_app:
      app_id: "${GITHUB_APP_ID}"
      installation_id: "${GITHUB_INSTALLATION_ID}"
      private_key_path: "/path/to/github-app-private-key.pem"
      # Alternative: private key as environment variable
      private_key: "${GITHUB_APP_PRIVATE_KEY}"
    
    # Method 3: OAuth App
    oauth:
      client_id: "${GITHUB_CLIENT_ID}"
      client_secret: "${GITHUB_CLIENT_SECRET}"
      redirect_uri: "${GITHUB_REDIRECT_URI}"

  # Rate Limiting Configuration
  rate_limit:
    # Requests per hour (GitHub default: 5000 for authenticated users)
    requests_per_hour: 5000
    
    # Burst capacity for short-term spikes
    burst: 100
    
    # Delay between retries when rate limited
    retry_delay: "5s"
    
    # Maximum number of retries
    max_retries: 3
    
    # Enable adaptive rate limiting
    adaptive: true

  # Repository Discovery Configuration
  discovery:
    # Organizations to scan
    organizations:
      - name: "mycompany"
        # Organization-specific filters
        filters:
          include_private: true
          include_archived: false
          include_forks: false
          languages: ["JavaScript", "Python", "Go", "Java"]
          min_stars: 1
          topics: ["security", "api", "library"]
          exclude_patterns: ["test-*", "demo-*", "archived-*"]
      
      - name: "security-team"
        filters:
          include_private: true
          languages: ["Python", "Go"]
          topics: ["security", "vulnerability"]
    
    # Individual users to scan
    users:
      - name: "security-engineer"
        filters:
          include_private: false
          languages: ["Python", "Go"]
          min_stars: 5
    
    # Specific repositories to include
    repositories:
      - "mycompany/critical-app"
      - "mycompany/security-tools"
      - "security-team/vulnerability-scanner"
    
    # Search queries for advanced discovery
    search_queries:
      - query: "org:mycompany language:go stars:>10"
        description: "Go repositories with more than 10 stars"
      - query: "org:mycompany topic:security"
        description: "Security-related repositories"
      - query: "user:security-engineer language:python"
        description: "Python repositories from security engineer"
    
    # Discovery scheduling
    schedule:
      # How often to run discovery
      interval: "1h"
      
      # Maximum repositories to discover per run
      max_repos_per_run: 1000
      
      # Timeout for discovery operations
      timeout: "10m"

  # Webhook Configuration
  webhooks:
    enabled: true
    
    # Webhook endpoint URL
    endpoint: "https://typosentinel.example.com/webhooks/github"
    
    # Webhook secret for validation
    secret: "${GITHUB_WEBHOOK_SECRET}"
    
    # Content type
    content_type: "application/json"
    
    # SSL verification
    ssl_verification: true
    
    # Events to subscribe to
    events:
      - "push"
      - "pull_request"
      - "release"
      - "repository"
      - "package"
    
    # Webhook security settings
    security:
      # Validate webhook signatures
      validate_signature: true
      
      # Allowed IP ranges (GitHub webhook IPs)
      allowed_ips:
        - "192.30.252.0/22"
        - "185.199.108.0/22"
        - "140.82.112.0/20"
        - "143.55.64.0/20"
      
      # Rate limiting for webhooks
      rate_limit: 100

  # GitHub Enterprise Server Configuration
  enterprise:
    enabled: false
    
    # Enterprise server URL
    base_url: "https://github.enterprise.com/api/v3"
    
    # Enterprise-specific settings
    settings:
      # Skip SSL verification (for self-signed certificates)
      skip_ssl_verify: false
      
      # Custom CA certificate path
      ca_cert_path: "/path/to/ca-cert.pem"
      
      # Enterprise API version
      api_version: "v3"

  # Scanning Configuration
  scanning:
    # Package managers to analyze
    package_managers:
      - "npm"
      - "pip"
      - "go"
      - "maven"
      - "nuget"
      - "composer"
      - "cargo"
      - "rubygems"
    
    # File patterns to include
    include_patterns:
      - "**/package.json"
      - "**/package-lock.json"
      - "**/yarn.lock"
      - "**/requirements.txt"
      - "**/Pipfile"
      - "**/go.mod"
      - "**/go.sum"
      - "**/pom.xml"
      - "**/build.gradle"
      - "**/Cargo.toml"
      - "**/composer.json"
      - "**/Gemfile"
    
    # File patterns to exclude
    exclude_patterns:
      - "**/node_modules/**"
      - "**/vendor/**"
      - "**/.git/**"
      - "**/test/**"
      - "**/tests/**"
      - "**/__pycache__/**"
      - "**/target/**"
      - "**/build/**"
      - "**/dist/**"
    
    # Maximum file size to scan (in bytes)
    max_file_size: 10485760  # 10MB
    
    # Scan timeout per repository
    timeout: "30m"
    
    # Concurrent scans
    concurrency: 5

  # Caching Configuration
  cache:
    enabled: true
    
    # Cache backend (redis, memory, file)
    backend: "redis"
    
    # Cache TTL for different data types
    ttl:
      repositories: "24h"
      organizations: "12h"
      users: "6h"
      search_results: "1h"
    
    # Redis configuration (if using redis backend)
    redis:
      host: "localhost"
      port: 6379
      password: "${REDIS_PASSWORD}"
      database: 0
      pool_size: 10

  # Monitoring and Metrics
  monitoring:
    enabled: true
    
    # Metrics to collect
    metrics:
      - "api_requests_total"
      - "api_request_duration"
      - "rate_limit_remaining"
      - "repositories_discovered"
      - "scan_duration"
      - "webhook_events_received"
    
    # Health check configuration
    health_check:
      enabled: true
      interval: "5m"
      timeout: "30s"
      endpoints:
        - "https://api.github.com/rate_limit"

  # Logging Configuration
  logging:
    level: "info"
    
    # Log API requests and responses
    log_requests: false
    
    # Log webhook events
    log_webhooks: true
    
    # Sensitive fields to redact from logs
    redact_fields:
      - "token"
      - "password"
      - "secret"
      - "private_key"

# Integration with TypoSentinel Core
integration:
  # Enable GitHub integration
  enabled: true
  
  # Priority for this platform (higher = more priority)
  priority: 1
  
  # Tags to apply to all GitHub repositories
  tags:
    - "github"
    - "git"
    - "source-control"
  
  # Custom metadata to include
  metadata:
    platform: "github"
    source: "api"
    version: "v1"