{
  "openapi": "3.0.3",
  "info": { "title": "TypoSentinel API", "version": "1.0.1", "description": "Minimal OpenAPI spec for current TypoSentinel endpoints" },
  "servers": [ { "url": "http://localhost:8080", "description": "Local development server" } ],
  "paths": {
    "/health": { "get": { "tags": ["Health"], "summary": "Health check", "responses": { "200": { "description": "Server is healthy", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HealthResponse" } } } } } } },
    "/ready": { "get": { "tags": ["Health"], "summary": "Readiness check", "responses": { "200": { "description": "Readiness status", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReadyResponse" } } } } } } },
    "/v1/analyze": { "post": { "tags": ["Analysis"], "summary": "Analyze a single package for supply-chain threats", "security": [ { "bearerAuth": [] } ], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AnalysisRequest" } } } }, "responses": { "200": { "description": "Analysis result", "headers": { "X-RateLimit-Remaining": { "description": "Remaining requests in current window", "schema": { "type": "integer" } } }, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AnalysisResponse" } } } }, "429": { "description": "Rate limit exceeded", "headers": { "Retry-After": { "description": "Seconds until next allowed request", "schema": { "type": "string" } } }, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/v1/analyze/batch": { "post": { "tags": ["Analysis"], "summary": "Analyze multiple packages in batch", "security": [ { "bearerAuth": [] } ], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BatchAnalysisRequest" } } } }, "responses": { "200": { "description": "Batch analysis summary", "headers": { "X-RateLimit-Remaining": { "description": "Remaining requests in current window", "schema": { "type": "integer" } } }, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BatchAnalysisResponse" } } } }, "429": { "description": "Rate limit exceeded", "headers": { "Retry-After": { "description": "Seconds until next allowed request", "schema": { "type": "string" } } }, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } },
    "/metrics.json": { "get": { "tags": ["Metrics"], "summary": "JSON metrics snapshot", "responses": { "200": { "description": "Metrics snapshot", "content": { "application/json": { "schema": { "type": "object" } } } } } } },
    "/metrics": { "get": { "tags": ["Metrics"], "summary": "Prometheus metrics", "responses": { "200": { "description": "Prometheus exposition format", "content": { "text/plain": { "schema": { "type": "string" } } } } } } },
    "/v1/stream": { "get": { "tags": ["Metrics"], "summary": "Server-Sent Events stream", "responses": { "200": { "description": "SSE stream", "content": { "text/event-stream": { "schema": { "type": "string" } } } } } } },
    "/api/v1/webhooks/{provider}": { "post": { "tags": ["Webhooks"], "summary": "Ingest webhook events", "parameters": [ { "name": "provider", "in": "path", "required": true, "schema": { "type": "string", "enum": ["github", "gitlab", "bitbucket", "azure"] } }, { "name": "X-Hub-Signature-256", "in": "header", "required": false, "schema": { "type": "string" } }, { "name": "X-GitHub-Event", "in": "header", "required": false, "schema": { "type": "string" } }, { "name": "X-GitHub-Delivery", "in": "header", "required": false, "schema": { "type": "string" } } ], "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } }, "responses": { "200": { "description": "Webhook processed", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WebhookResponse" } } } }, "401": { "description": "Invalid or missing signature", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } } } } }
  },
  "components": {
    "securitySchemes": { "bearerAuth": { "type": "http", "scheme": "bearer" } },
    "schemas": {
      "HealthResponse": { "type": "object", "properties": { "status": { "type": "string", "example": "ok" } } },
      "ReadyResponse": { "type": "object", "properties": { "ready": { "type": "boolean" }, "timestamp": { "type": "string", "format": "date-time" }, "redis": { "type": "object", "properties": { "configured": { "type": "boolean" }, "connected": { "type": "boolean" } } }, "webhooks": { "type": "object" } }, "required": ["ready", "timestamp"] },
      "AnalysisRequest": { "type": "object", "required": ["package_name", "registry"], "properties": { "package_name": { "type": "string", "example": "express" }, "registry": { "type": "string", "enum": ["npm", "pypi", "go", "maven"] } } },
      "AnalysisResponse": { "type": "object", "properties": { "package_name": { "type": "string" }, "registry": { "type": "string" }, "risk_level": { "type": "integer" } } },
      "BatchAnalysisRequest": { "type": "object", "required": ["packages"], "properties": { "packages": { "type": "array", "items": { "type": "object", "required": ["package_name", "registry"], "properties": { "package_name": { "type": "string" }, "registry": { "type": "string", "enum": ["npm", "pypi", "go", "maven"] } } } } } },
      "BatchSummary": { "type": "object", "properties": { "total": { "type": "integer" }, "high_risk": { "type": "integer" }, "medium_risk": { "type": "integer" }, "low_risk": { "type": "integer" }, "no_threats": { "type": "integer" } } },
      "BatchAnalysisResponse": { "type": "object", "properties": { "summary": { "$ref": "#/components/schemas/BatchSummary" } } },
      "WebhookResponse": { "type": "object", "properties": { "status": { "type": "string", "example": "processed" } } },
      "ErrorResponse": { "type": "object", "properties": { "error": { "type": "string" }, "status": { "type": "string" } } }
    }
  }
}

