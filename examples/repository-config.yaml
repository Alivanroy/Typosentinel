# Repository Connector Configuration Example
# This file demonstrates how to configure Typosentinel for repository scanning
# across multiple platforms including GitHub, GitLab, Bitbucket, and Azure DevOps

# Repository Manager Configuration
repository:
  # Maximum number of concurrent repository scans
  max_concurrent_scans: 10
  
  # Timeout for individual repository scans
  scan_timeout: "30m"
  
  # Number of retry attempts for failed operations
  retry_attempts: 3
  
  # Delay between retry attempts
  retry_delay: "5s"
  
  # Enable metrics collection
  enable_metrics: true
  
  # Default filters applied to all repository discovery
  default_filters:
    include_private: false
    include_archived: false
    include_forks: false
    min_stars: 1
    languages: ["Go", "Python", "JavaScript", "TypeScript", "Java", "C#"]
    exclude_patterns: ["test-*", "demo-*", "example-*"]

# Platform-specific connector configurations
platforms:
  # GitHub Configuration
  github:
    # GitHub API base URL (use https://api.github.com for GitHub.com)
    base_url: "https://api.github.com"
    
    # Authentication configuration
    auth:
      # Personal Access Token (recommended)
      token: "${GITHUB_TOKEN}"
      
      # Alternative: GitHub App authentication
      # app_id: "${GITHUB_APP_ID}"
      # installation_id: "${GITHUB_INSTALLATION_ID}"
      # private_key_path: "/path/to/github-app-private-key.pem"
    
    # Request timeout
    timeout: "30s"
    
    # Rate limiting configuration
    rate_limit:
      requests_per_hour: 5000
      burst: 100
    
    # GitHub-specific settings
    settings:
      # Include GitHub Enterprise Server support
      enterprise: false
      
      # API version (usually not needed)
      api_version: "2022-11-28"
  
  # GitLab Configuration
  gitlab:
    # GitLab API base URL
    base_url: "https://gitlab.com/api/v4"
    
    # Authentication
    auth:
      token: "${GITLAB_TOKEN}"
      
      # Alternative: OAuth2
      # client_id: "${GITLAB_CLIENT_ID}"
      # client_secret: "${GITLAB_CLIENT_SECRET}"
      # redirect_uri: "${GITLAB_REDIRECT_URI}"
    
    timeout: "30s"
    
    # GitLab-specific settings
    settings:
      # Include GitLab.com or self-hosted
      self_hosted: false
      
      # API version
      api_version: "v4"
  
  # Bitbucket Configuration
  bitbucket:
    # Bitbucket API base URL
    base_url: "https://api.bitbucket.org/2.0"
    
    # Authentication
    auth:
      # App Password method (recommended)
      username: "${BITBUCKET_USERNAME}"
      password: "${BITBUCKET_APP_PASSWORD}"
      
      # Alternative: OAuth2
      # client_id: "${BITBUCKET_CLIENT_ID}"
      # client_secret: "${BITBUCKET_CLIENT_SECRET}"
    
    timeout: "30s"
    
    # Bitbucket-specific settings
    settings:
      # Support for Bitbucket Server (on-premise)
      server_mode: false
      
      # API version
      api_version: "2.0"
  
  # Azure DevOps Configuration
  azuredevops:
    # Azure DevOps base URL
    base_url: "https://dev.azure.com"
    
    # Authentication
    auth:
      # Personal Access Token
      token: "${AZURE_DEVOPS_TOKEN}"
      
      # Alternative: Service Principal
      # tenant_id: "${AZURE_TENANT_ID}"
      # client_id: "${AZURE_CLIENT_ID}"
      # client_secret: "${AZURE_CLIENT_SECRET}"
    
    timeout: "30s"
    
    # Azure DevOps-specific settings
    settings:
      # Organization name (if not in base_url)
      organization: "${AZURE_DEVOPS_ORG}"
      
      # API version
      api_version: "7.0"

# Repository Discovery Configuration
discovery:
  # Discovery interval (how often to scan for new repositories)
  interval: "1h"
  
  # Maximum repositories to discover per platform per run
  max_repos_per_platform: 1000
  
  # Number of worker goroutines for parallel discovery
  workers: 4
  
  # Timeout for discovery operations
  timeout: "5m"
  
  # Global discovery filters
  include_private: false
  include_forks: false
  include_archived: false
  
  # Advanced filtering
  filter:
    languages: ["Go", "Python", "JavaScript", "TypeScript"]
    topics: ["security", "api", "library"]
    min_stars: 5
    max_size: 104857600  # 100MB in bytes
    name_pattern: "*"
    exclude_patterns: 
      - "test-*"
      - "demo-*"
      - "example-*"
      - "*-archived"
  
  # Platform-specific discovery configuration
  platforms:
    - platform: "github"
      enabled: true
      
      # Organizations to scan
      organizations:
        - "mycompany"
        - "myteam"
      
      # Specific repositories to include
      repositories:
        - "mycompany/critical-app"
        - "myteam/security-tools"
      
      # Search queries for repository discovery
      search_queries:
        - "org:mycompany language:go"
        - "org:mycompany topic:security"
      
      # Platform-specific filters
      filter:
        min_stars: 10
        languages: ["Go", "Python"]
    
    - platform: "gitlab"
      enabled: true
      
      # GitLab groups to scan
      organizations:
        - "mygroup"
        - "security-team"
      
      # Specific projects
      repositories:
        - "mygroup/api-gateway"
        - "security-team/vulnerability-scanner"
      
      # Search queries
      search_queries:
        - "group:mygroup"
        - "topic:security"
    
    - platform: "bitbucket"
      enabled: true
      
      # Bitbucket workspaces
      organizations:
        - "myworkspace"
      
      repositories:
        - "myworkspace/main-application"
    
    - platform: "azuredevops"
      enabled: true
      
      # Azure DevOps organizations/projects
      organizations:
        - "myorganization"
      
      repositories:
        - "myorganization/MyProject/main-repo"

# Webhook Configuration (for real-time updates)
webhooks:
  enabled: true
  
  # Webhook endpoint URL
  endpoint: "https://typosentinel.example.com/webhooks"
  
  # Secret for webhook validation
  secret: "${WEBHOOK_SECRET}"
  
  # Events to subscribe to
  events:
    - "push"
    - "pull_request"
    - "release"
  
  # Platform-specific webhook settings
  platforms:
    github:
      content_type: "json"
      ssl_verification: true
    
    gitlab:
      push_events: true
      merge_requests_events: true
      releases_events: true
    
    bitbucket:
      active: true
    
    azuredevops:
      resource_version: "1.0"

# Scanning Configuration
scanning:
  # Types of scans to perform
  scan_types:
    - "dependency"
    - "vulnerability"
    - "license"
    - "secret"
  
  # Package managers to analyze
  package_managers:
    - "npm"
    - "pip"
    - "go"
    - "maven"
    - "nuget"
    - "composer"
    - "cargo"
  
  # Scan scheduling
  schedule:
    # Cron expression for scheduled scans
    cron: "0 2 * * *"  # Daily at 2 AM
    
    # Timezone for scheduling
    timezone: "UTC"
  
  # Scan filters
  filters:
    # Skip files matching these patterns
    exclude_paths:
      - "node_modules/**"
      - "vendor/**"
      - "*.min.js"
      - "*.test.js"
      - "test/**"
      - "tests/**"
    
    # Only scan files matching these patterns
    include_paths:
      - "package.json"
      - "requirements.txt"
      - "go.mod"
      - "pom.xml"
      - "*.csproj"
      - "composer.json"
      - "Cargo.toml"

# Logging Configuration
logging:
  level: "info"
  format: "json"
  
  # Log file configuration
  file:
    enabled: true
    path: "/var/log/typosentinel/repository.log"
    max_size: "100MB"
    max_backups: 5
    max_age: 30  # days
  
  # Console logging
  console:
    enabled: true
    colored: true

# Metrics and Monitoring
metrics:
  enabled: true
  
  # Prometheus metrics endpoint
  prometheus:
    enabled: true
    endpoint: "/metrics"
    port: 9090
  
  # Custom metrics
  custom:
    - name: "repositories_discovered_total"
      type: "counter"
      help: "Total number of repositories discovered"
    
    - name: "scan_duration_seconds"
      type: "histogram"
      help: "Time taken to scan repositories"

# Cache Configuration
cache:
  enabled: true
  
  # Cache backend (memory, redis, file)
  backend: "memory"
  
  # Cache TTL settings
  ttl:
    repository_list: "1h"
    repository_content: "30m"
    organization_list: "6h"
  
  # Redis configuration (if using redis backend)
  redis:
    address: "localhost:6379"
    password: "${REDIS_PASSWORD}"
    database: 0
  
  # File cache configuration (if using file backend)
  file:
    directory: "/tmp/typosentinel-cache"
    max_size: "1GB"

# Security Configuration
security:
  # TLS configuration
  tls:
    enabled: true
    cert_file: "/etc/ssl/certs/typosentinel.crt"
    key_file: "/etc/ssl/private/typosentinel.key"
  
  # API authentication
  api_auth:
    enabled: true
    method: "bearer"  # bearer, basic, api_key
    token: "${API_TOKEN}"
  
  # Rate limiting for API endpoints
  rate_limiting:
    enabled: true
    requests_per_minute: 100
    burst: 20