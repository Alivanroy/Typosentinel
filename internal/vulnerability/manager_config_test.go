package vulnerability

import (
	"github.com/Alivanroy/Typosentinel/pkg/types"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"testing"
)

func TestManager_GetDatabaseNamesAndCount(t *testing.T) {
	cfg := &ManagerConfig{}
	mgr := NewManager(cfg)
	mgr.databases = map[string]types.VulnerabilityDatabase{
		"osv":    &mockDB{name: "osv"},
		"github": &mockDB{name: "github"},
	}
	names := mgr.GetDatabaseNames()
	assert.Contains(t, names, "osv")
	assert.Contains(t, names, "github")
	assert.Equal(t, 2, mgr.GetDatabaseCount())
}

func TestManager_UpdateConfiguration(t *testing.T) {
	cfg := &ManagerConfig{}
	mgr := NewManager(cfg)
	newCfg := &ManagerConfig{Databases: []types.VulnerabilityDatabaseConfig{{Type: "osv", Enabled: true}}}
	mgr.UpdateConfiguration(newCfg)
	names := mgr.GetDatabaseNames()
	require.NotEmpty(t, names)
	assert.Contains(t, names, "osv")
}
