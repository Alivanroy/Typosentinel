/*
Python Malware Detection Rules
Generated by Typosentinel Python Malware Analysis
*/

rule Python_Malware_BeautifulSoup_Critical {
    meta:
        description = "Detects critical malware in beautifulsoup package"
        author = "Typosentinel"
        date = "2025-08-10"
        severity = "critical"
        
    strings:
        $compile1 = "compile('[a-zA-Z][-_.:a-zA-Z0-9]*'"
        $compile2 = "compile("([<>]|""
        $hex1 = "\x80"
        $hex2 = "\x9f"
        $package = "BeautifulSoup"
        
    condition:
        $package and ($compile1 or $compile2) and ($hex1 or $hex2)
}

rule Python_Malware_Pandas3_Credentials {
    meta:
        description = "Detects credential theft in pandas3 package"
        author = "Typosentinel"
        date = "2025-08-10"
        severity = "high"
        
    strings:
        $aws = ".aws"
        $secret = "secret"
        $post = "requests.post"
        $package = "pandas3"
        
    condition:
        $package and $post and ($aws or $secret)
}

rule Python_Malware_Django_Dev_System {
    meta:
        description = "Detects system compromise patterns in django-dev"
        author = "Typosentinel"
        date = "2025-08-10"
        severity = "high"
        
    strings:
        $getattr = "getattr(self, 'op_%s'"
        $argv = "sys.argv"
        $package = "django_dev"
        
    condition:
        $package and ($getattr or $argv)
}

rule Python_Typosquatting_General {
    meta:
        description = "General typosquatting detection for Python packages"
        author = "Typosentinel"
        date = "2025-08-10"
        severity = "medium"
        
    strings:
        $pandas2 = "pandas2"
        $pandas3 = "pandas3"
        $flasks = "flasks"
        $beautifulsoup = "beautifulsoup"
        $django_dev = "django-dev"
        
    condition:
        any of them
}
